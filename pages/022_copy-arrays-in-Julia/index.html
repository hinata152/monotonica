<!doctype html> <html lang=ja > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=preconnect  href="https://fonts.googleapis.com"> <link rel=preconnect  href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&family=Zen+Kaku+Gothic+New:wght@500&display=swap" rel=stylesheet > <link rel=stylesheet  href="/monotonica/libs/highlight/github.min.css"> <link rel=stylesheet  href="/monotonica/css/franklin.css"> <link rel=stylesheet  href="/monotonica/css/poole_lanyon.css"> <link rel=stylesheet  href="/monotonica/css/adjust.css"> <link rel=icon  href="/monotonica/assets/favicon.png"> <title>Juliaでの配列のコピー</title> <input type=checkbox  class=sidebar-checkbox  id=sidebar-checkbox > <div class=sidebar  id=sidebar > <div class=sidebar-item > <p>A theme adapted from <a href="http://lanyon.getpoole.com/" target=_blank >Lanyon</a>.</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/monotonica/">Home</a> <a class="sidebar-nav-item " href="/monotonica/about/">About</a> <a class="sidebar-nav-item " href="/monotonica/tag/tech/">Tech</a> <a class="sidebar-nav-item " href="/monotonica/tag/misc/">Misc</a> <a class="sidebar-nav-item " href="/monotonica/license-monotonica/">License</a> </nav> <div class=sidebar-item > <p>&copy; hinagata.</p> </div> </div> <!-- Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS collisions with our real content. --> <div class=wrap > <div class=masthead > <div class=container > <h3 class=masthead-title > <a href="/monotonica/" title=Home >monotonica</a> <small>Engimono Notebook and more</small> </h3> </div> </div> <div class="container content"> <div class=franklin-content > <h1 id="juliaでの配列のコピー"><a href="#juliaでの配列のコピー" class=header-anchor >Juliaでの配列のコピー</a></h1> <p>shallow copyとdeep copyの違いについて。</p> <p>文献 <sup id="fnref:1"><a href="#fndef:1" class=fnref >[1]</a></sup> を読んでいたら気になる記述を見つけた。 コードブロックのところだけ引用。</p> <pre><code class="julia hljs">A = [<span class=hljs-number >1</span>, <span class=hljs-number >2</span>, <span class=hljs-number >3</span>] <span class=hljs-comment ># 列ベクトルを作る</span>
B = A         <span class=hljs-comment ># いわゆる shallow copy になる　(ポインタだけ複製する)</span>
A[<span class=hljs-number >1</span>] = <span class=hljs-number >5</span></code></pre> <p>手元の環境 &#40;Julia Version 1.7.2 &#40;2022-02-06&#41;&#41; で試すとたしかにこうなる。 これには気付いていなかった。</p> <p><a href="/monotonica/pages/018_quasi1d-nozzle-flow1/">1次元ノズルフローを解いた</a>手元のソースコードでは、1ステップ前の値を保存する際にFortranライクに以下のケース1のように書いていたが、これは適切ではない。 意図した結果を得るためにはケース2もしくは3のようにする必要がある。</p> <pre><code class="julia hljs"><span class=hljs-comment ># case1</span>
rold = r

<span class=hljs-comment ># case2</span>
rold[:] = r[:]

<span class=hljs-comment ># case3</span>
<span class=hljs-keyword >for</span> j=<span class=hljs-number >1</span>:N
    rold[j] = r[j]
<span class=hljs-keyword >end</span></code></pre> <p>先ほどの文献 <sup id="fnref:1"><a href="#fndef:1" class=fnref >[1]</a></sup> でもdeep copyとする例が示されている。</p> <pre><code class="julia hljs">B = A[:]         <span class=hljs-comment ># ベクトルのすべての要素をコピー</span>
B = deepcopy(A)  <span class=hljs-comment ># shallow copy に対して deep copy</span></code></pre> <p>ところで計算に必要な配列をどのように確保し・どのように計算ルーチンに渡せばよいかの知見はまだない。 今のところは配列をすべて <code>global</code> で宣言する雑なやり方で対応しているけど、もっと良いやり方に変えていきたい。</p> <table class=fndef  id="fndef:1"> <tr> <td class=fndef-backref ><a href="#fnref:1">[1]</a> <td class=fndef-content >富永, &quot;Juliaでふつうの統計解析（第二版）&quot; &#40;2021&#41; </table> <div class=page-foot > <div class=copyright > &copy; hinagata. Last modified: June 19, 2022. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. <a href="https://hinata152.github.io/monotonica/about/#%E5%85%8D%E8%B2%AC%E4%BA%8B%E9%A0%85">免責事項</a> </div> </div> </div> </div> </div> <label for=sidebar-checkbox  class=sidebar-toggle ></label>