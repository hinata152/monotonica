<!doctype html> <html lang=ja > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=preconnect  href="https://fonts.googleapis.com"> <link rel=preconnect  href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&family=Zen+Kaku+Gothic+New:wght@500&display=swap" rel=stylesheet > <link rel=stylesheet  href="/monotonica/libs/katex/katex.min.css"> <link rel=stylesheet  href="/monotonica/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/monotonica/css/franklin.css"> <link rel=stylesheet  href="/monotonica/css/poole_lanyon.css"> <link rel=stylesheet  href="/monotonica/css/adjust.css"> <link rel=icon  href="/monotonica/assets/favicon.png"> <title>JuliaでGIFアニメーションを作る</title> <input type=checkbox  class=sidebar-checkbox  id=sidebar-checkbox > <div class=sidebar  id=sidebar > <div class=sidebar-item > <p>A theme adapted from <a href="http://lanyon.getpoole.com/" target=_blank >Lanyon</a>.</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/monotonica/">Home</a> <a class="sidebar-nav-item " href="/monotonica/about/">About</a> <a class="sidebar-nav-item " href="/monotonica/tag/tech/">Tech</a> <a class="sidebar-nav-item " href="/monotonica/tag/misc/">Misc</a> <a class="sidebar-nav-item " href="/monotonica/license-monotonica/">License</a> </nav> <div class=sidebar-item > <p>&copy; hinagata.</p> </div> </div> <!-- Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS collisions with our real content. --> <div class=wrap > <div class=masthead > <div class=container > <h3 class=masthead-title > <a href="/monotonica/" title=Home >monotonica</a> <small>Engimono Notebook and more</small> </h3> </div> </div> <div class="container content"> <div class=franklin-content > <h1 id="juliaでgifアニメーションを作る"><a href="#juliaでgifアニメーションを作る" class=header-anchor >JuliaでGIFアニメーションを作る</a></h1> <p>JuliaでPlotsのGIFアニメーションを作るときの覚え書き。</p> <h2 id="ソースコード"><a href="#ソースコード" class=header-anchor >ソースコード</a></h2> <p>1次元移流問題</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>q</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>+</mo><mi>c</mi><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>q</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mn>0</mn><mspace width=2em /><mo stretchy=false >(</mo><mi>c</mi><mo>&gt;</mo><mn>0</mn><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> \frac{\partial q}{\partial t} + c \frac{\partial q}{\partial x} = 0 \qquad (c&gt;0) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.0574em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord mathnormal">c</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >0</span><span class=mspace  style="margin-right:2em;"></span><span class=mopen >(</span><span class="mord mathnormal">c</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >&gt;</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >0</span><span class=mclose >)</span></span></span></span></span> <p>のGIFアニメーションを作る例。 ソースコードは<a href="https://github.com/kofujii1812/PythonCFD/blob/main/chapter2-2&#37;5B2&#37;5D-FTCS.ipynb">こちら</a>を参考にした。</p> <pre><code class="Julia hljs"><span class=hljs-keyword >using</span> Plots

c = <span class=hljs-number >1.0</span>
dt = <span class=hljs-number >0.05</span>
dx = <span class=hljs-number >0.1</span>
jmax = <span class=hljs-number >21</span>
nmax = <span class=hljs-number >6</span>

x = zeros(<span class=hljs-built_in >Float64</span>,jmax)
q = zeros(<span class=hljs-built_in >Float64</span>,jmax)
qold = zeros(<span class=hljs-built_in >Float64</span>,jmax)

<span class=hljs-keyword >for</span> j=<span class=hljs-number >1</span>:jmax
    x[j] = dx * (j - <span class=hljs-number >1</span>)
    <span class=hljs-keyword >if</span> x[j] &lt; <span class=hljs-number >1</span>
        q[j] = <span class=hljs-number >1</span>
    <span class=hljs-keyword >else</span>
        q[j] = <span class=hljs-number >0</span>
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>

anim = <span class=hljs-meta >@animate</span> <span class=hljs-keyword >for</span> n=<span class=hljs-number >1</span>:nmax
    qold = q
    <span class=hljs-keyword >for</span> j=<span class=hljs-number >2</span>:jmax-<span class=hljs-number >1</span>
        q[j] = qold[j] - dt * c * (qold[j+<span class=hljs-number >1</span>] - qold[j-<span class=hljs-number >1</span>]) / (<span class=hljs-number >2.0</span> * dx)
    <span class=hljs-keyword >end</span>
    plt = plot(x, q, label=<span class=hljs-string >&quot;FTCS&quot;</span>,
               linestyle=:solid, color=:black,
               marker=:circle, markercolor=:blue,
               title=<span class=hljs-string >&quot;n=<span class=hljs-variable >$n</span>&quot;</span>, xlabel=<span class=hljs-string >&quot;x&quot;</span>, ylabel=<span class=hljs-string >&quot;q&quot;</span>, ylim=(<span class=hljs-number >0</span>,<span class=hljs-number >2.0</span>))
    <span class=hljs-comment ># display(plt) # check</span>
<span class=hljs-keyword >end</span>

gif(anim, <span class=hljs-string >&quot;FTCS.gif&quot;</span>, fps=<span class=hljs-number >2</span>)</code></pre> <p>最終行よりGIFアニメーションのファイルが出力される。</p> <p><img src="/monotonica/pages/img/20220604133533.gif" alt="" /></p> <ul> <li><p>時間発展のfor文の前に<code>anim &#61; @animate</code>を置く。ループ中で<code>plot</code>関数を呼んでおいて、ループ終了後に<code>gif</code>関数を呼ぶことで動画を生成できる。</p> <ul> <li><p><code>gif</code>関数のファイル名と<code>fps</code>の値はお好みで設定する。</p> </ul> <li><p>ループ中で呼んだ<code>plt &#61; plot&#40;&#41;</code>の後に<code>display&#40;plt&#41;</code>すれば、おのおののフレームの静止画を取得できる。</p> <li><p><code>plot&#40;&#41;</code>について（<a href="https://docs.juliaplots.org/latest/generated/attributes_series/">参考</a>）</p> <ul> <li><p><code>label</code>でその要素の凡例を表示。</p> <li><p><code>linestyle</code>で線分の種類を設定。破線 &#40;<code>:dash</code>&#41; などにもできる。<code>color</code>で線の色を設定。</p> <li><p><code>marker</code>でマーカーの形状を設定。四角 &#40;<code>:rect</code>&#41; などにもできる。<code>markercolor</code>でマーカーの色を設定。</p> <li><p><code>title</code>でグラフ上部のタイトルを設定。ステップ数を表示する例（変数を簡単に含められる）: <code>title&#61;&quot;n&#61;&#36;n&quot;</code></p> <li><p><code>xlabel &#40;ylabel&#41;</code>で軸のタイトルを設定。</p> <li><p><code>ylim&#61;&#40;0,2.0&#41;</code>の要領で軸の上下限値を設定。</p> </ul> <li><p>ループ中で<code>plt &#61; plot&#33;&#40;&#41;</code>とすれば別要素の重ね書きもできる。（解析解を重ね書きしようと思ったがやめた）</p> </ul> <p>アニメーションで見てわかる通り、時間発展にともなって不連続面に振動が生じている。 &quot;一般的な流体問題を対象とする場合、このような計算法は不安定な計算法と理解できます。&#40;p. 27&#41;&quot; <sup id="fnref:1"><a href="#fndef:1" class=fnref >[1]</a></sup> これは残念。</p> <p><table class=fndef  id="fndef:1"> <tr> <td class=fndef-backref ><a href="#fnref:1">[1]</a> <td class=fndef-content >藤井, 立川. Pythonで学ぶ流体力学の数値計算法. Ohmsha, 2020. </table> 追記: アニメーションを取得するステップ間隔を変えたい場合、ループ内で<code>plot&#40;&#41;</code>を呼ぶ回数を制御するのではなく、for文に付随する<code>every</code>で制御する。</p> <p>例えば10ステップおきにしたい場合、</p> <pre><code class="julia hljs">anim = <span class=hljs-meta >@animate</span> <span class=hljs-keyword >for</span> n=<span class=hljs-number >1</span>:nmax

    ...

    <span class=hljs-keyword >if</span> n % <span class=hljs-number >10</span> == <span class=hljs-number >0</span>
        plt = plot(x, q, label=<span class=hljs-string >&quot;FTCS&quot;</span>,
                   linestyle=:solid, color=:black,
                   marker=:circle, markercolor=:blue,
                   title=<span class=hljs-string >&quot;n=<span class=hljs-variable >$n</span>&quot;</span>, xlabel=<span class=hljs-string >&quot;x&quot;</span>, ylabel=<span class=hljs-string >&quot;q&quot;</span>, ylim=(<span class=hljs-number >0</span>,<span class=hljs-number >2.0</span>))
        <span class=hljs-comment ># display(plt) # check</span>
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span></code></pre> <p>ではなく、</p> <pre><code class="julia hljs">anim = <span class=hljs-meta >@animate</span> <span class=hljs-keyword >for</span> n=<span class=hljs-number >1</span>:nmax

    ...

    plt = plot(x, q, label=<span class=hljs-string >&quot;FTCS&quot;</span>,
               linestyle=:solid, color=:black,
               marker=:circle, markercolor=:blue,
               title=<span class=hljs-string >&quot;n=<span class=hljs-variable >$n</span>&quot;</span>, xlabel=<span class=hljs-string >&quot;x&quot;</span>, ylabel=<span class=hljs-string >&quot;q&quot;</span>, ylim=(<span class=hljs-number >0</span>,<span class=hljs-number >2.0</span>))
    <span class=hljs-comment ># display(plt) # check</span>
<span class=hljs-keyword >end</span> every <span class=hljs-number >10</span></code></pre> <p>とする。（<a href="https://docs.juliaplots.org/latest/animations/">参考</a>）</p> <div class=page-foot > &copy; hinagata. Last modified: February 26, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. <a href="https://hinata152.github.io/monotonica/about/#%E5%85%8D%E8%B2%AC%E4%BA%8B%E9%A0%85">免責事項</a> </div> </div> </div> </div> <script src="/monotonica/libs/highlight/highlight.min.js"></script> <script>hljs.highlightAll();hljs.configure({tabReplace: ' '});</script> <label for=sidebar-checkbox  class=sidebar-toggle ></label>